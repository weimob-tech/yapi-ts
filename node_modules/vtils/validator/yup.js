import * as yup from "./yupSource";
import { isChineseIDCardNumber, isPossibleChineseMobilePhoneNumber } from "../utils";
import { zhCN } from "./locale/zhCN"; // 实现 chineseMobilePhoneNumber 验证器

yup.addMethod(yup.string, 'chineseMobilePhoneNumber', function (message) {
  if (message === void 0) {
    message = yup.getLocale().string.chineseMobilePhoneNumber;
  }

  return this.test('chineseMobilePhoneNumber', message, isPossibleChineseMobilePhoneNumber);
}); // 实现 chineseIDCardNumber 验证器

yup.addMethod(yup.string, 'chineseIDCardNumber', function (message) {
  if (message === void 0) {
    message = yup.getLocale().string.chineseIDCardNumber;
  }

  return this.test('chineseIDCardNumber', message, isChineseIDCardNumber);
}); // 实现 validateInOrder 方法

yup.addMethod(yup.object, 'validateInOrder', function (data, options) {
  var _this = this;

  return Object.keys(data).reduce(function (prev, key) {
    return prev.then(function () {
      var schema;

      try {
        schema = yup.reach(_this, key);
      } catch (e) {}

      return schema ? _this.validateAt(key, data, options) : undefined;
    });
  }, Promise.resolve()).then(function () {
    return _this.cast(data);
  });
}); // 实现 validateInOrderSync 方法

yup.addMethod(yup.object, 'validateInOrderSync', function (data, options) {
  for (var _i = 0, _Object$keys = Object.keys(data); _i < _Object$keys.length; _i++) {
    var key = _Object$keys[_i];
    var schema = void 0;

    try {
      schema = yup.reach(this, key);
    } catch (e) {}

    if (schema) {
      this.validateSyncAt(key, data, options);
    }
  }

  return this.cast(data);
}); // 实现 validatePlus 方法

yup.addMethod(yup.mixed, 'validatePlus', function (data, options) {
  return (this.type === 'object' ? this.validateInOrder(data, options) : this.validate(data, options)).then(function (data) {
    return {
      data: data
    };
  }).catch(function (error) {
    return {
      error: error,
      data: data
    };
  });
}); // 实现 validatePlusSync 方法

yup.addMethod(yup.mixed, 'validatePlusSync', function (data, options) {
  try {
    var _data = this.type === 'object' ? this.validateInOrderSync(data, options) : this.validateSync(data, options);

    return {
      data: _data
    };
  } catch (error) {
    return {
      error: error,
      data: data
    };
  }
}); // 设置中文为默认语言

yup.setLocale(zhCN);
export { yup };