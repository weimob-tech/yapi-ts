import { ensureInMiniProgram } from "./ensureInMiniProgram";
import { isPromiseLike } from "../utils";
import { miniProgramBus } from "./miniProgramBus";
import { useEffect } from 'react';
import { useLatest } from "../react";
export function usePullDownRefresh(callback) {
  var latestCallback = useLatest(callback);
  useEffect(function () {
    return miniProgramBus.on('currentPagePullDownRefresh', function () {
      ensureInMiniProgram(function (mp) {
        var res = latestCallback.current();

        if (isPromiseLike(res)) {
          res.then(function () {
            return mp.stopPullDownRefresh();
          });
        } else {
          mp.stopPullDownRefresh();
        }
      });
    });
  }, []);
}